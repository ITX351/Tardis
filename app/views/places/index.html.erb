<% provide(:title, "HIT NAV | Place Information") %> 

<div id="nav">
	<ul class="nav nav-tabs" style = "margin: 0em 10em">
		<li><%= link_to t(:placeshome), places_path %></li>
		<li><%= link_to t(:allplaces), allplaces_path %></li>
		<% @placeclassify.each do |classify| %>
			<li><%= link_to classify[0], classifyshowing_url(classify[1]) %></a></li>
		<% end %>
		<li><%= link_to t(:unclassifiedplaces), classifyshowing_url(0) %></li>
	</ul>
</div>

<div id="main">
	<% @classifyshow.each do |classify| %>
		<br/><br/>
		<div class="container-thin">
			<% if @indexshow %>
				<div class = "row">
					<div class="col-md-2">
						<div class="image-category">
							<%= image_tag(classify[:imagename]) %>
						</div>
					</div>
					<div class="col-md-4">
					</div>
					<div class="col-md-3">
						<div class="image-category image-more">
							<%= link_to image_tag("more2.png"), classifyshowing_url(classify[:id]) %>
						</div>
					</div>
					<div class="col-md-3">
						<br/><br/>
						<span style="text-align:left;color:#009fc6"><h4><b>|</b> 点击排行榜</h4></span>
					</div>
				</div>
			<% end %>

			<div class="row">
				<div class="col-md-9">
					<% classify[:places].each do |place| %>
					<div class="col-md-4">
						<section class="placeblock">
							<a href="#" class="image"><%= image_tag(place.avatar_url(:big)) if place.avatar %></a>
								<div class="content">
									<div class = "row">	
										<div class = "col-md-10" style = "text-align:left">
											<h5 style="margin:0 0 0 1em"><%= link_to place.name, place, style: "color:black;text-decoration:none"%></h5>

										</div>
										<div class = "col-md-2">
										</div>
									</div>
									<div class = "cont_two">
										<small style: "color:#a3a3a3"><%= place.intro %></small>
									</div>
									<div class="button">
										<%= link_to " Read More", place, :method => :get, style: "color:white;		text-decoration: none;"%>
									</div>
								</div>
						</section>
					</div>
					<% end %>
				</div>
				<div class="col-md-3">
					
				</div>
			</div>

			<div class="divider">&nbsp;</div>
		</div>

		<div style="height:5px;width:1000px"> <!--tail -->
		</div>

	<% end %>
</div> <!-- end of main -->

<div id="tail">
	<p>Copyright &copy; Tardis 2015</p>
</div>

<style>
	
	#nav
	{
		align:center;
		background: #fffacd url(<%= asset_path("overlay2.png") %>) repeat;
		/*background: #fff;*/
	}
	#main
	{
		position: relative;
		background: #fffacd url(<%= asset_path("overlay2.png") %>) repeat;
		/*background: #fff;*/
		/*z-index:  -666;*/
	}
	.container-thin
	{
		margin: 0em 0em 4em 0em;
		width:1000px;
		height: 400px;
		/*background: #fffacd url(<%= asset_path("overlay2.png") %>) repeat;*/
		/*background-color: rgba(255, 250, 205, 0.6);*/
		background-color: rgba(255, 255, 255, 0.6);
		border-radius: 8px;
	}
	.placeblock
	{
		width:100%;
		height: 20em;
		padding: 0.3em 0.3em 0.3em 0.3em;
		border-radius: 3px;
	}
	.placeblock:hover
	{

		border-color: #87CEFA;
		box-shadow: 0 0 0 2px #87CEFA;
	}


	.image-category
	{
		width:200px;
		position:relative;
		left: 30px; right:0px;
		overflow: hidden;
	}
	.image-more
	{
		left: 5em; 
		top:18px;
	}
	.image
	{
		display: inline-block;
		height: 62%;
	}
	
	.image img
	{
		display: block;
		width: 100%;
		border-radius: 6px;
	}
	.button
	{
		position: relative;
		display: inline-block;
		margin-top: 0.3em;
		margin-right: 7em;
		padding: 0.3em 1em;
		background: #b2dfee;
		border-radius: 6px;
		text-decoration: none;
		text-transform: uppercase;
		font-size: 0.9em;
		color: #FFF;
		-moz-transition: color 0.35s ease-in-out, background-color 0.35s ease-in-out;
		-webkit-transition: color 0.35s ease-in-out, background-color 0.35s ease-in-out;
		-o-transition: color 0.35s ease-in-out, background-color 0.35s ease-in-out;
		-ms-transition: color 0.35s ease-in-out, background-color 0.35s ease-in-out;
		transition: color 0.35s ease-in-out, background-color 0.35s ease-in-out;
		cursor: pointer;
	}

	.button:hover
	{
		background: #009fc6;
		color: #FFF !important;
	}
	#tail
	{
		position: relative;
		padding: 3em 0em;
		background: #ffec8b url(<%= asset_path("overlay.png")%>) repeat center;
		/*background: #ffec8b url(<%= asset_path("img01.jpg")%>) repeat center;*/
	}
	#tail p
	{
		color:#c1cdcd;
	}
</style>


<!-- <%= stylesheet_link_tag "jquery.min.js" %>
<%= stylesheet_link_tag "place/skel-noscript"%>
<%= stylesheet_link_tag "place/style2"%>
<%= stylesheet_link_tag "place/style-desktop"%>

<%= javascript_include_tag "place/skel.min.js" %>
<%= javascript_include_tag "place/skel-panels.min.js" %>
<%= javascript_include_tag "place/init.js" %> -->

<style>
	/*最多显示one or two行，多余的用...代替*/
	.cont_one{ 
		width: 125px;
		height: 25px;
		line-height: 25px;
		text-align: left;
		text-overflow: -o-ellipsis-lastline;
		overflow: hidden;
		text-overflow: ellipsis;
		display: -webkit-box;
		-webkit-line-clamp: 1;
		-webkit-box-orient: vertical;
	 }
	.cont_two{		
		width: 140px;
		height: 50px;
		line-height: 25px;
		text-align: left;
		text-overflow: -o-ellipsis-lastline;
		overflow: hidden;
		text-overflow: ellipsis;
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
	}
</style>

<script>
	var map = new BMap.Map("indexmap");
	var point = new BMap.Point(126.638718,45.749316);
	var schoolcenter = new BMap.Point(126.638718,45.749316);
	map.centerAndZoom(point,17);
	map.setMinZoom(16);
	map.addControl(new BMap.MapTypeControl());					//添加地图类型控件
	var b = new BMap.Bounds(new BMap.Point(126.627938, 45.74145),
						new BMap.Point(126.647629, 45.756771));
	try {	
		BMapLib.AreaRestriction.setBounds(map, b);
	} catch (e) {
		alert(e);
	}

	function addMaker(point){
		var marker = new BMap.Marker(point);
		map.addOverlay(marker);
		return marker;
	}
	function addInfoWindow(marker, intro){
		var opts = {
			title: intro[0],
			width: 250,
			height: 200
		}
		var content = intro[1];
		var info = new BMap.InfoWindow(content, opts);
		var openInforWinFun = function(){
			marker.openInfoWindow(info);
		}
		marker.addEventListener("click", openInforWinFun);
		return openInforWinFun;
	}

	function work(){
		<% if !@indexshow and @classifyshow.count > 0 %>
			<% @classifyshow[0][:places].each do |place| %>
				var marker = new addMaker(new BMap.Point(<%= place.locationx%>, <%= place.locationy%>));
				var intro = ['<h3><%= place.name%></h3>', '<%= place.intro%><br/><%=link_to "More", place %>'];
				addInfoWindow(marker, intro);
			<% end %>
		<% end %>
	}

	//初始化模板选择的下拉框
	var sel = document.getElementById('stylelist');
	var item = new Option("Normal", "normal");
	sel.options.add(item);
	item = new Option("Light", "light");
	sel.options.add(item);
	item = new Option("Midnight", "midnight");
	sel.options.add(item);
	item = new Option("Dark", "dark");
	sel.options.add(item);
	
	window.reload(work());
	
	changeMapStyle('normal')
	function changeMapStyle(mystyle){
		map.setMapStyle({style:mystyle});
		$('#desc').html(mapstyles[style].desc);
	}	
</script>

