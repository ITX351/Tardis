
<div style = "width:80%; background-color: rgba(0, 255, 255, 0.1)">
	<div class = "row">
		<div class = "col-md-12">
			<h2><%= @place.name %></h2>
			<hr>
			<div = class = "row">
				<div class = "col-md-6" style = "overflow:hidden">
					<%= image_tag(@place.avatar_url(:bigest), :style => "max-width:90%") if @place.avatar%> <br/>
					<a data-toggle="modal" href="#showimg" class="btn">view original image</a>
						</div>
					<div class = "col-md-6">
						<div class="input-group" style = "margin: 0em 10em">
							<span class="input-group-addon" id="basic-addon3">
								&nbsp; &nbsp; Stars&nbsp; &nbsp; </span>
							<button class = "form-control"
								style = "width: 11em" aria-describedby="basic-addon2">
							<%= ratings_for @place, :static, :dimensions => :tot%></button>
						</div>
						<br>
						<div class="input-group" style = "margin: 0em 10em">
							<span class="input-group-addon" id="basic-addon3">
								&nbsp;&nbsp;Score It&nbsp;</span>
							<button class = "form-control"
								style = "width: 11em" aria-describedby="basic-addon2">
								<%= ratings_for @place, :show_user_rating => true %></button>
						</div>
						<hr>
									
						<hr>
						<div class = "row"	style = "margin: 0em 3em">
							<div class = "col-md-6">
								<a href = "#comments">there are <%= @place.comments.size%> comments</a><br/>
								Maker: <%= link_to @place.user.nickname, user_url(@place.user_id) %>
								Classify:<%= @placeclassifyname %>
							</div>
							<div class = "col-md-6">
								<a href = "#showinmap" class = " btn btn-default">Show it in map </a>
							</div>
						</div>
						<br>
						<div class="panel panel-default" style = "text-align:left; margin: 0em 2em">
							<div class="panel-heading">
								<h3 class="panel-title">Introduction</h3>
							</div>
							<div class="panel-body">
								<%=@place.intro %>
							</div>
						</div>
					<hr>
				</div>
			</div>
			<p>
				<%= link_to "Back", places_path, :method => :get %>
				|
				<% if (current_user == @place.user or (!current_user.nil? and current_user.authority == 1))%>
					<%= link_to "You can edit it", edit_place_path(@place), :method => :get%>
				<% else %>
					<%= link_to "Submit my update application", updateapply_url(@place), :method => :get%>
				<% end %>
				|
				<%= link_to "Delete", @place, :method => :delete, :confirm => "Are you sure?" %>
			</p>
		</div>
	</div>
	<hr>

	<div id = "showinmap" class = "row">
		<br/><br/>
		<div id="showmap" class = "col-md-8"
							style="width: 600px; 
									height: 400px;
									margin: auto auto auto 2em; 
									border: 1px solid gray;
									overflow:hidden;">
			</div>
			<div class = "col-md-4">
				<div id="r-result" class = "row" style = "margin: 0em 4em">
				<div class="input-group">
						<span class="input-group-addon" id="basic-addon1">Choose Map Style</span>
					<select id="stylelist" onchange="changeMapStyle(this.value)" 
						style = "width: 8em" class = "form-control btn btn-default"
						 aria-describedby="basic-addon1"></select>
				</div>
			</div>	
			<br/>
				<div class = "row" style = "margin: 0em 4em">
					<div class="input-group">
						<span class="input-group-addon" id="basic-addon2">
							&nbsp;&nbsp;Set Start Point &nbsp;&nbsp;&nbsp;</span>
					<button class = "form-control	btn btn-primary" onclick = "findPath()"
						style = "width: 8em" aria-describedby="basic-addon2">
						Go here</button>
				</div>
				</div>
				<br/>
				<div id="showtextroute" style = "margin: 0em 1em"></div>
		</div>
	</div>

	<hr/>


	<h3>Comments  for This Place</h3>
	<div id = "comments" class = "row"	style = "width:80%">
		<hr>
		<div class = "row" align = "left">
				<% if @place.comments.size == 0 %>
					<comment style = "font-size: 20px">
						There are no comments,  you can be the first!
					</comment>
				<% else %>
						<% @place.comments.each do |comment| %>
							<div class = "row">
								<% user = find_user(comment.user_id) %>
								<div class = "col-md-1">
									<%= gravatar_image_tag(user.email, :alt => user.nickname, :gravatar => { :size => 50}, :class => " img-circle") %> <br/> 
								</div>
								<div class = "col-md-11" >
									<div class = "username" style = "margin-left:-2px">
										<%= link_to find_user(comment.user_id).nickname, 
											user_url(comment.user_id) , :style => "color: #969696;font-weight:600"%> <br>
									</div>
									<div class = "comment" >
										<%= comment.content %><br>
									</div>
									<div class = "timeago">
										<%= time_ago_in_words comment.created_at %> ago</em><br>
									</div>
								</div>
								
							</div>
							<hr>
						<% end %>

				<% end %>
		</div>
		<hr>
		<div class="row form-group" >
			<%= form_for [@place, @place.comments.build] do |f| %>
			<%= f.text_area :content, class: "form-control", placeholder: "Enter Your Comments", rows: 5, cols: 40 %>
			<br/>
			<%= f.submit "Post Your Comment", class: "btn btn-default"%>
			<% end %>
		</div>

		<hr>

	</div>


	<!-- 模态框（Modal） -->
	<div id="showimg"	class="modal fade" tabindex="-1" role="dialog" 
			 aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<%= image_tag(@place.avatar_url, :style => "max-width:100%") if @place.avatar%>
						<button type="button" class="btn btn-primary" 
									data-dismiss="modal">OK
						</button>
				</div>
	</div><!-- /.modal -->
</div>

<script>
	var map = new BMap.Map("showmap");
	window.map = map;

	var point = new BMap.Point(126.638718,45.749316);
	var schoolcenter = new BMap.Point(126.638718,45.749316);
	map.centerAndZoom(point,17);
	map.setMinZoom(16);
	//map.enableScrollWheelZoom();		//鼠标滚轮缩放
	map.enableContinuousZoom();			//让地图启动滑动效果
	var b = new BMap.Bounds(new BMap.Point(126.627938, 45.74145),
							new BMap.Point(126.647629, 45.756771));
	try {	
		BMapLib.AreaRestriction.setBounds(map, b);
	} catch (e) {
		alert(e);
	}
	map.addControl(new BMap.NavigationControl());	
	map.addControl(new BMap.MapTypeControl());					//添加地图类型控件

	var nowPoint = new BMap.Point(<%= @place.locationx%>, <%= @place.locationy%>);
	var des = new BMap.Marker(nowPoint); 
	var src = new BMap.Marker(nowPoint); 
	map.addOverlay(des);
	map.centerAndZoom(nowPoint, 18);
	var Find = 0;
	map.addEventListener("click", function(e){
		map.removeOverlay(src);
		var point = new BMap.Point(e.point.lng, e.point.lat);
		var focus = new BMap.Marker(new BMap.Point(e.point.lng, e.point.lat));	 
		map.addOverlay(focus);
		src = focus;
		Find = 1;
	});

	function findPath(){
		if(Find == 0){
			alert("Please select the Starting Point first");
		}
		else{
			var walking = new BMap.WalkingRoute(map, {renderOptions:{map: map, panel : "showtextroute", autoViewport: true}});
			walking.search(src, des);
		}
	}

	//初始化模板选择的下拉框
	var sel = document.getElementById('stylelist');
	var item = new Option("Normal", "normal");
	sel.options.add(item);
	item = new Option("Light", "light");
	sel.options.add(item);
	item = new Option("Midnight", "midnight");
	sel.options.add(item);
	item = new Option("Dark", "dark");
	sel.options.add(item);

	changeMapStyle('normal')
	function changeMapStyle(mystyle){
		map.setMapStyle({style:mystyle});
		$('#desc').html(mapstyles[style].desc);
		return false;
	}
</script>

<style>
	.username{
		margin-left: 10px;
	}
	.comment{
		font-size: 18px;
	}
	.timeago{
		color: #cdcdc1;
	}
</style>

