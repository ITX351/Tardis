<%= stylesheet_link_tag    "main.css", :media => "all" %>

<h1>Add New Place</h1>
<%= form_for(@place) do |f| %>
    <div class="field">
        <div class = "col-md-2"><h2><%= f.label :name, "font-size" => 20 %></div></h2>
        <div class = "col-md-10"><%= f.text_field :name, placeholder: "Input name of place"%></div>
    </div>
    <br/><br/><br/>
    <div class="field">
        <div class = "col-md-2"> <button class = "btn btn-primary btn-lg" data-toggle = "modal" data-target = "#myModal">Set Position</button></div>
       
        <div class = "col-md-5">
            <%= f.text_field :locationx, placeholder: "location-x" %>
        </div>
        <div class = "col-md-5">
            <%= f.text_field :locationy, placeholder: "location-y" %>
        </div>
    </div>
    <br/><br/><br/>
    <div class="field">
        <div class = "col-md-2"><h2>Introduction</h2></div>
        <div class = "col-md-10"><%= f.text_area :intro, rows: 10, placeholder: "Input some brief descriptions..." %> </div>
    </div>
    <br/><br/><br/>
    <br/><br/><br/>
    <div class = "field">
        <div class = "col-md-12"><%= f.file_field :avatar %> </div>
        <div class = "col-md-0"><%= f.hidden_field :avatar_cache %> </div>
    </div>
    <br/><br/><br/>
    <div class="actions ">
      <%= f.submit "New Place", class: "actions special"%>
    </div>

<!-- 模态框（Modal） -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" 
   aria-labelledby="myModalLabel" aria-hidden="true" style="width:800px">
   <div class="modal-dialog">

        <div id="container" class = "col-md-10" align = "center"
                style="width: 500px; 
                    height: 500px; 
                    border: 1px solid gray;
                    overflow:hidden;">
        </div>
        <%= javascript_include_tag "map.js" %>
        <div class = "col-md-2">
            <button type="button" class="btn btn-primary" 
               data-dismiss="modal">OK
            </button>
        </div>
    </div>
</div><!-- /.modal -->

<% end %>

<script> 
    map.addEventListener("click", function(e){//µØÍ¼µ¥»÷ÊÂ¼þ
        map.clearOverlays();
        document.getElementById("place_locationx").value = e.point.lng;
        document.getElementById("place_locationy").value = e.point.lat;

        var point = new BMap.Point(e.point.lng, e.point.lat);
        var marker = new BMap.Marker(new BMap.Point(e.point.lng, e.point.lat));  // ´´½¨±ê×¢£¬ÎªÒª²éÑ¯µÄµØ·½¶ÔÓ¦µÄ¾­Î³¶È
        map.addOverlay(marker);
    });
    function setCenter(){
        map.centerAndZoom(schoolcenter,17);
    }
    window.reload(setCenter());    
</script>




